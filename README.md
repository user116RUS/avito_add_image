# Обработчик XML-выгрузки товаров Авито

Скрипт для автоматической обработки XML-выгрузки товаров Авито с заменой описаний и наложением изображений.

## Функциональность

1. Загрузка XML-файла товаров по указанной ссылке
2. Замена текста описания на новый шаблон
3. Обработка изображений:
   - Наложение изображений из папки `images` на первые 4 фотографии товара
   - Добавление 3 фотографий магазина из папки `shop`
   - Ограничение общего количества изображений до 10
   - **НОВОЕ:** Загрузка обработанных изображений на Google Drive с прямыми ссылками
4. Создание Excel-файла с данными, включая дополнительные столбцы:
   - InternetCalls (значение "Да")
   - CallsDevices (значение "115407847")
   - ImageUrls (список URL изображений, разделенных символом "|")
   - Все параметры из исходного XML сохраняются в таблице
5. Выгрузка обработанного файла на Google Drive
6. Периодическое обновление данных (каждый час или раз в день)

## Новые функции

### Загрузка изображений на Google Drive

Теперь добавлена возможность загружать обработанные изображения на Google Drive и использовать прямые ссылки на изображения в таблице Excel. Это позволяет:

1. Получить публичный доступ к обработанным изображениям
2. Использовать прямые URL вместо локальных путей
3. Включить несколько изображений в одну ячейку Excel, разделяя их символом "|"

### Формат ссылок на изображения

Ссылки на изображения имеют формат прямых HTTP-ссылок, при переходе по которым сразу открывается изображение без элементов интерфейса:
```
https://drive.google.com/uc?export=view&id=ИДЕНТИФИКАТОР_ФАЙЛА
```

### Запуск скрипта с Google Drive

Для запуска скрипта с загрузкой изображений на Google Drive, используйте команду:

```
python run_with_gdrive.py
```

Для работы с Google Drive необходимо иметь файл `google_cred.json` с учетными данными сервисного аккаунта. Этот же файл используется для загрузки Excel-таблиц.

### Преимущества использования Google Drive

1. Единая система авторизации с уже настроенными учетными данными
2. Надежное хранение изображений с возможностью публичного доступа
3. Высокая скорость доступа к изображениям
4. Неограниченное время хранения и доступность файлов
5. Работа со статического IP-адреса VPS

## Установка и запуск

1. Установите зависимости:
```
pip install -r requirements.txt
```

2. Убедитесь, что файл учетных данных Google API (`google_cred.json`) находится в корневой директории проекта.

3. Выберите подходящий способ запуска:

**Вариант 1:** Запуск с обновлением каждый час:
```
python main.py
```

**Вариант 2:** Запуск с обновлением раз в сутки (в 3:00):
```
python run_daily.py
```

**Вариант 3:** Однократный запуск без автоматического обновления:
```
python run_manual.py
```

**Вариант 4:** Запуск с использованием локального XML-файла:
```
python run_local.py
```

**Вариант 5:** Запуск с загрузкой изображений на Google Drive:
```
python run_with_gdrive.py
```

**Вариант 6:** Проверка функции наложения изображений:
```
python test_overlay.py
```

## Структура проекта

- `main.py` - основной скрипт обработки
- `run_daily.py` - скрипт для ежедневного обновления
- `run_manual.py` - скрипт для однократного запуска без автообновления
- `run_local.py` - скрипт для работы с локальным XML-файлом
- `run_with_gdrive.py` - скрипт для работы с загрузкой на Google Drive
- `test_overlay.py` - скрипт для тестирования наложения изображений
- `google_cred.json` - учетные данные для Google API
- `images/` - папка с изображениями для наложения (1.png, 2.png, 3.png, 4.png)
- `shop/` - папка с изображениями магазина
- `processed_images/` - папка для сохранения обработанных изображений (создается автоматически)
- `avito_processed.xml` - обработанный XML-файл (создается автоматически)
- `avito_processed.xlsx` - Excel-файл с данными (создается автоматически)

## Примечания

- Скрипт периодически проверяет наличие изменений в исходном XML-файле и обновляет выходные данные.
- Изображения обрабатываются локально и загружаются на Google Drive для публичного доступа.
- Для корректной работы с Google Drive API требуется сервисный аккаунт с разрешениями на запись.
- Количество изображений ограничено до 10, включая изображения магазина.
- Максимальный размер одного изображения не должен превышать 25 Мб.